<!-- templates/review.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>Content Reviewer</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .post-card {
        background: white;
        padding: 20px;
        margin: 15px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .post-content {
        font-size: 16px;
        margin: 15px 0;
        padding: 15px;
        background: #f9f9f9;
        border-left: 3px solid #1da1f2;
      }
      .post-meta {
        color: #666;
        font-size: 14px;
        margin: 10px 0;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
      }
      .approve-btn {
        background: #1da1f2;
        color: white;
      }
      .edit-btn {
        background: #657786;
        color: white;
      }
      .approved {
        border-left: 3px solid #17bf63;
      }
      textarea {
        width: 100%;
        min-height: 100px;
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>üîç Content Review Dashboard</h1>
    <p>Review and approve your generated content before posting</p>

    {% for post in posts %}
    <div class="post-card {% if post.get('approved') %}approved{% endif %}">
      <div class="post-meta">
        <strong>Category:</strong> {{ post.category }} |
        <strong>Type:</strong> {{ post.type }} {% if post.get('approved') %}
        <span style="color: #17bf63">‚úì Approved</span>
        {% endif %}
      </div>

      <div class="post-content" id="content-{{ loop.index0 }}">
        {{ post.content }}
      </div>

      <div>
        <button class="edit-btn" onclick="editPost({{ loop.index0 }})">
          ‚úèÔ∏è Edit
        </button>
        <button class="approve-btn" onclick="approvePost({{ loop.index0 }})">
          ‚úì Approve
        </button>
      </div>
    </div>
    {% endfor %}

    <script>
      function approvePost(index) {
        fetch('/approve', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ index: index }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert('Post approved!');
              location.reload();
            }
          });
      }

      function editPost(index) {
        const contentDiv = document.getElementById(`content-${index}`);
        const currentContent = contentDiv.textContent.trim();

        const textarea = document.createElement('textarea');
        textarea.value = currentContent;
        textarea.id = `edit-${index}`;

        contentDiv.innerHTML = '';
        contentDiv.appendChild(textarea);

        const saveBtn = document.createElement('button');
        saveBtn.textContent = 'üíæ Save';
        saveBtn.className = 'approve-btn';
        saveBtn.onclick = () => saveEdit(index);
        contentDiv.appendChild(saveBtn);
      }

      function saveEdit(index) {
        const textarea = document.getElementById(`edit-${index}`);
        const newContent = textarea.value;

        fetch('/edit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ index: index, content: newContent }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert('Post updated!');
              location.reload();
            }
          });
      }
    </script>
  </body>
</html>
